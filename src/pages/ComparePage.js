import React from "react";
import SheetMusic from "../components/SheetMusic";
import {PlayJSON} from "../scripts/PlayJSON";
import {Redirect} from "react-router-dom";
import axios from "axios";

// The page where the user sees the comparison between their input and the actual song
class ComparePage extends React.Component {
  /*
  redirect_home: whether the page should prepare to redirect to the home page
  actual_song: the note data on the song generated by the site
  corrected_song: the note data on the user input corrected
  */
  state = {
    redirect_home: false,
    actual_song: [],
    corrected_song: []
  };

  componentDidMount() {
    //Sends in the data to check if the user input is correct
    if (!this.props.hasPost()) {
      this.setState({
        redirect_home: true
      });
    } else {
      axios
        .post("/submit", this.props.popPost())
        .then(response => {
          this.setState({
            actual_song: response.data.actual,
            corrected_song: response.data.corrected
          });
          console.log(response);
        })
        .catch(function(error) {
          console.log(error);
        });
    }
  }

  render() {
    if (this.state.redirect_home) {
      return <Redirect to="/" />;
    }
    return (
      <div className="App">
        <SheetMusic
          keyId={1}
          width={window.innerWidth - 10 * 2}
          height={window.innerHeight / 2}
          notes={this.state.actual_song}
          editable={false}
        />
        <button onClick={() => PlayJSON(this.state.actual_song)}>play</button>
        <SheetMusic
          keyId={2}
          width={window.innerWidth - 10 * 2}
          height={window.innerHeight / 2}
          notes={this.state.corrected_song}
          editable={false}
          comparison={true}
        />
        <button onClick={() => PlayJSON(this.state.corrected_song)}>
          play
        </button>
      </div>
    );
  }
}

export default ComparePage;
